<html lang="en" class="m-0 p-0">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>BioSense-AI</title>
</head>

<body class="m-0 p-0 bg-blue-200 text-center content-center">

    <h1 class="mt-10 text-3xl font-bold text-blue-700">Welcome to Biosence-AI</h1>

    <canvas id="StressChart" class="p-10 m-auto max-w-2xl w-fit h-fit"></canvas>

    <p>Patient's State : <span id="person_id">Loading...</span></p>
    <p>Patient's stress level is <span id="stress_id">Loading...</span> % </p>

    <br></br>

    <form action="/" method="POST">
        <div class="text-center py-4 lg:px-4">
            <div class="p-2 bg-red-800 items-center text-red-100 leading-none lg:rounded-full flex lg:inline-flex"
                role="alert">
                <span class="flex rounded-full bg-red-500 uppercase px-2 py-1 text-xs font-bold mr-3"><input
                        type="submit" name="submit" value="OFF"></span>
                <span class="font-semibold mr-2 text-left flex-auto">SPO2 Sensor is OFF</span>
                <svg class="fill-current opacity-75 h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                    <path d="M12.95 10.707l.707-.707L8 4.343 6.586 5.757 10.828 10l-4.242 4.243L8 15.657l4.95-4.95z" />
                </svg>
            </div>
        </div>
        <!-- Turn SpO2 Sensor ON/OFF: -->
        <!-- <input type="submit" name="submit" value="On"> -->
        <!-- <input type="submit" name="submit" value="Off"> -->
        <p>Patient's Blood SpO2 level is <span id="spo2_id">Loading...</span></p>
        <p>Patient's BPM level is <span id="bpm_id">Loading...</span></p>
        <br><br>
        Stethoscope Analysis :
        <button value="Connect" type="submit"
            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full">
            Connect
        </button>
        <br><br><br>
        <p>Predictions from Steathascope report: Loading...</span></p>
    </form>


    <h1 class="text-2xl font-bold text-red-500 my-10"> Electro Cardio Graph </h1>
    <canvas id="myChart" class="m-auto mt-3 w-full max-w-2xl"></canvas>
    <br></br>
    <form action="/" method="POST">
        Biosense-AI Report :
        <button type="submit" name="submit" value="Generate now"
            class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
            Generate
        </button>
    </form>



    <script> //updateVals chart
        function updateValues() {
            fetch('/state_page')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('person_id').innerHTML = data;
                });
            fetch('/spo2')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('spo2_id').innerHTML = data;
                });
            fetch('/temp')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('stress_id').innerHTML = data;
                });
        }
        setInterval(updateValues, 1000); // Update every second
    </script>

    <script> //Stress chart
        var xValues = ["Stressed", "Normal", "Calm"];
        var yValues = [78, 12, 10];
        var barColors = [
            "#b91d47",
            "#2b5797",
            "#ffffff",

        ];

        new Chart("StressChart", {
            type: "doughnut",
            data: {
                labels: xValues,
                datasets: [{
                    backgroundColor: barColors,
                    borderWidth: 0,
                    data: yValues
                }]
            },
            options: {
                title: {
                    display: false,
                    text: "Based on Patients SpO2 and BPM Analysis"
                }
            }
        });
    </script>
    <script>
        ///////////////////////////////////////////////////////////////////////////
        // ECG chart
        ///////////////////////////////////////////////////////////////////////////
        xValues = Array(100).fill(0)
        yValues = Array(100).fill(12000)
        // Function to update the chart
        // function updateChartData() {
        //     fetch('/ecg_data')
        //         .then(response => response.text())
        //         .then(data => {
        //             ecg_val = parseInt(data);
        //             yValues.push((ecg_val));
        //         })
        //     xValues.push(xValues[xValues.length - 1] + 1);
        //     yValues.shift();
        //     xValues.shift();
        //     chart.update();
        // }

        // Pusing Limits :)
        num = 20;
        function updateChartDataFast() {
            for (let i = 0; i < num; i++) {
                fetch('/ecg_data')
                    .then(response => response.text())
                    .then(data => {
                        ecg_val = parseInt(data);
                        console.log(ecg_val);
                        yValues.push((ecg_val));
                    })
            }
            xValues.push(xValues[xValues.length - 1] + num);
            yValues.shift(num);
            xValues.shift(num);
            chart.update();
        }

        const chart = new Chart("myChart", {
            type: "line",
            data: {
                labels: xValues,
                datasets: [{
                    data: yValues,
                    borderColor: "red",
                    borderWidth: 2,
                    radius: 0,
                    fill: false,
                    // cubicInterpolationMode: 'monotone',
                    tension: 0.4
                }],
            },
            options: {
                animation: {
                    duration: 10,
                },
                plugins: {
                    // animation,
                    interaction: {
                        intersect: false
                    },
                    tooltip: { enabled: false },
                    scales: {
                        y: {
                            min: 10000,
                            max: 22000,
                            type: 'linear',
                        },
                        x: {
                            type: 'linear'
                        }
                    },
                    legend: {
                        display: false
                    }
                },
            },
        });

        setInterval(updateChartDataFast, 100);
        // setInterval(updateChartData, 100);
    </script>
</body>

</html>