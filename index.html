<html lang="en" class="m-0 p-0">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <script  type="text/javascript" src="./scripts.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <title>BioSense-AI</title>
</head>
<!-- <body style="width:960px; margin: 20px auto; background-color: lightblue; padding: 20px;"> -->
<body class="m-20 p-20">

<h1 class="text-3xl font-bold text-clifford">Welcome to Biosence-AI</h1>

<canvas id="StressChart" class="p-10" style="width:100%;max-width:600px"></canvas>


<p>Patient's State : <span id="person_id">Loading...</span></p>
<p>Patient's stress level is <span id="stress_id">Loading...</span> % </p>

<br></br>

<form action="/" method="POST">
    Turn SpO2 Sensor ON/OFF:
    <input type="submit" name="submit" value="On">
    <input type="submit" name="submit" value="Off">
    <p>Patient's Blood SpO2 level is <span id="spo2_id">Loading...</span></p>
    <p>Patient's BPM level is <span id="bpm_id">Loading...</span></p>
    <br><br>
    Stethoscope Analysis :
    <input type="submit" name="submit" value="Connect">
    <p>Predictions from Steathascope report: Loading...</span></p>

</form>
<h4> ECG signal of the Patient </h4>
<canvas id="myChart" style="width:100%;max-width:700px"></canvas>
<br></br>
<form action="/" method="POST">
    Generate the AI-report :
    <input type="submit" name="submit" value="Generate now">
</form>


<script> //updateVals chart
    function updateValues() {
        fetch('/state_page')
            .then(response => response.text())
            .then(data => {
                document.getElementById('person_id').innerHTML = data;
            });
        fetch('/spo2')
            .then(response => response.text())
            .then(data => {
                document.getElementById('spo2_id').innerHTML = data;
            });       
        fetch('/temp')
            .then(response => response.text())
            .then(data => {
                document.getElementById('stress_id').innerHTML = data;
            });
    }
    setInterval(updateValues, 1000); // Update every second
</script>

<script> //Stress chart
    var xValues = ["Stressed", "Charam"];
    var yValues = [78, 22];
    var barColors = [
      "#b91d47",
      "#2b5797"
    ];
    
    new Chart("StressChart", {
      type: "doughnut",
      data: {
        labels: xValues,
        datasets: [{
          backgroundColor: barColors,
          data: yValues
        }]
      },
      options: {
        title: {
          display: true,
          text: "Based on Patients SpO2 and BPM Analysis"
        }
      }
    });
</script>
<h2>ECG Plot</h2>
<script> //ECG chart
xValues = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
yValues = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
// Function to update the chart
function updateChartData() {
    var ecg_val;
    fetch('/data')
            .then(response => response.text())
            .then(data => {
                ecg_val = parseInt(data);
                console.log(ecg_val);
                yValues.push((ecg_val));
            })
    // yValues.push((ecg_val * 2000) + 800);  // Generate random values
    xValues.push(xValues[xValues.length - 1] + 1);
    if (yValues.length > xValues.length) {
        yValues.shift();
        xValues.shift();
    }
    chart.update();
}

const chart = new Chart("myChart", {
    type: "line",
    data: {
        labels: xValues,
        datasets: [{
            data: yValues,
            borderColor: "red",
            fill: false,
        }],
    },
    options: {
        legend: {display: false}
    },
});
setInterval(updateChartData, 100);
</script>
</body>
</html>